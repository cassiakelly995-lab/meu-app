<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MESTRA V8 | GERENCIADOR DE ACESSOS</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background-color: #000; color: #00ff00; font-family: 'Courier New', monospace; padding: 20px; }
        .container { max-width: 800px; margin: auto; border: 1px solid #00ff00; padding: 20px; box-shadow: 0 0 20px rgba(0,255,0,0.2); }
        h2 { text-align: center; border-bottom: 1px solid #00ff00; padding-bottom: 10px; }
        input { background: #000; border: 1px solid #00ff00; color: #00ff00; padding: 10px; width: 70%; margin-bottom: 10px; outline: none; }
        button { background: #00ff00; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .user-card { border: 1px solid #333; padding: 15px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .btn-link { background: #0078d4; color: white; padding: 5px 10px; font-size: 0.8rem; border-radius: 3px; }
        .status-ativo { color: #00ff00; font-weight: bold; }
        .status-off { color: #ff0000; }
    </style>
</head>
<body>

<div class="container">
    <h2>SISTEMA MESTRA V8 - CONTROLE</h2>
    
    <div style="text-align: center; margin-bottom: 30px;">
        <input type="text" id="nomeAdvogada" placeholder="NOME DA ADVOGADA (Ex: Dra Helen Cristina)">
        <button onclick="ativarAcesso()">GERAR E ATIVAR ACESSO</button>
    </div>

    <div id="listaUsuarios">
        </div>
</div>

<script>
    // CONFIGURAÇÃO DO SEU FIREBASE (MANTENHA A SUA)
    const firebaseConfig = { databaseURL: "https://cassiapromptv8-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // URL BASE DO SEU APP NO GITHUB
    const urlBase = "https://cassiakelly995-lab.github.io/meu-app/cassia-app.html";

    function ativarAcesso() {
        const nomeOriginal = document.getElementById('nomeAdvogada').value;
        if (nomeOriginal.trim() === "") return alert("Digite o nome!");

        // CRIA O ID LIMPO (Troca espaços por _)
        const idLimpo = nomeOriginal.trim().replace(/\s+/g, '_');

        // SALVA NO FIREBASE
        db.ref('clientes/' + idLimpo).set({
            nome: nomeOriginal,
            status: "ativo",
            dataAtivacao: new Date().toLocaleString()
        }).then(() => {
            alert("SISTEMA MESTRA: Acesso ativado para " + idLimpo);
            document.getElementById('nomeAdvogada').value = "";
        });
    }

    // ATUALIZA A LISTA COM BOTÃO DE LINK ÚNICO
    db.ref('clientes').on('value', (snapshot) => {
        const lista = document.getElementById('listaUsuarios');
        lista.innerHTML = "<h3>USUÁRIAS MONITORADAS:</h3>";
        
        snapshot.forEach((item) => {
            const user = item.val();
            const userId = item.key;
            const linkCompleto = `${urlBase}?id=${userId}`;

            lista.innerHTML += `
                <div class="user-card">
                    <div>
                        <strong>${user.nome}</strong><br>
                        <span class="status-ativo">● ATIVO</span> | ID: ${userId}
                    </div>
                    <div>
                        <button class="btn-link" onclick="copiarLink('${linkCompleto}')">COPIAR LINK ÚNICO</button>
                        <button style="background: red; color: white; padding: 5px;" onclick="remover('${userId}')">X</button>
                    </div>
                </div>
            `;
        });
    });

    function copiarLink(url) {
        navigator.clipboard.writeText(url);
        alert("LINK COPIADO COM SUCESSO!\n\nAgora é só colar no WhatsApp da cliente.");
    }

    function remover(id) {
        if(confirm("Deseja revogar o acesso de " + id + "?")) {
            db.ref('clientes/' + id).remove();
        }
    }
</script>

</body>
</html>
