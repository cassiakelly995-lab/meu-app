<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cassia Prompt - Acesso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap');
        
        * {
            font-family: 'Outfit', sans-serif;
        }
        
        .mono {
            font-family: 'Space Mono', monospace;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .brand-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .brand-link:hover {
            color: #764ba2;
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease;
        }

        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .lacuna-card {
            transition: all 0.3s ease;
            border-left: 4px solid #e5e7eb;
        }
        
        .lacuna-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left-color: #667eea;
        }
        
        .lacuna-card.filled {
            border-left-color: #10b981;
            background: #f0fdf4;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .category-badge {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body class="p-4">
    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="glass rounded-3xl p-8 max-w-md w-full slide-in">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">‚ú®</div>
                <h1 class="text-4xl font-bold gradient-text mb-2">Cassia Prompt</h1>
                <p class="text-gray-600">Criador Inteligente de Prompts</p>
            </div>

            <!-- Tabs Login/Cadastro -->
            <div class="flex border-b-2 border-gray-200 mb-6">
                <button 
                    id="loginTab" 
                    class="flex-1 py-3 text-gray-600 border-b-3 border-transparent transition-all font-semibold"
                    onclick="switchAuthTab('login')"
                    style="border-bottom: 3px solid #667eea; color: #667eea;"
                >
                    Entrar
                </button>
                <button 
                    id="registerTab" 
                    class="flex-1 py-3 text-gray-600 border-b-3 border-transparent transition-all font-semibold"
                    onclick="switchAuthTab('register')"
                >
                    Cadastrar
                </button>
            </div>

            <!-- Formul√°rio de Login -->
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Usu√°rio</label>
                        <input 
                            type="text" 
                            id="loginUsername" 
                            required
                            placeholder="Seu usu√°rio"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Senha</label>
                        <input 
                            type="password" 
                            id="loginPassword" 
                            required
                            placeholder="Sua senha"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                    </div>
                    <button type="submit" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg">
                        üöÄ Entrar
                    </button>
                </div>
            </form>

            <!-- Formul√°rio de Cadastro -->
            <form id="registerForm" class="hidden" onsubmit="handleRegister(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Nome Completo</label>
                        <input 
                            type="text" 
                            id="registerName" 
                            required
                            placeholder="Seu nome"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Usu√°rio</label>
                        <input 
                            type="text" 
                            id="registerUsername" 
                            required
                            pattern="[a-zA-Z0-9_]+"
                            title="Apenas letras, n√∫meros e _"
                            placeholder="usuario123"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                        <p class="text-xs text-gray-500 mt-1">Apenas letras, n√∫meros e _</p>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Senha</label>
                        <input 
                            type="password" 
                            id="registerPassword" 
                            required
                            minlength="6"
                            placeholder="M√≠nimo 6 caracteres"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Confirmar Senha</label>
                        <input 
                            type="password" 
                            id="registerPasswordConfirm" 
                            required
                            minlength="6"
                            placeholder="Digite a senha novamente"
                            class="input-field w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:outline-none"
                        />
                    </div>
                    <button type="submit" class="btn-primary w-full py-4 rounded-xl text-white font-semibold text-lg">
                        ‚ú® Criar Conta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="mainApp" class="hidden">
        <div class="max-w-6xl mx-auto">
            <!-- Header com Usu√°rio -->
            <div class="glass rounded-2xl p-6 mb-6 flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold gradient-text">
                        ‚ú® <a href="#" class="brand-link">Cassia Prompt</a>
                    </h1>
                    <p class="text-gray-600 text-sm mt-1">Criador Inteligente de Prompts</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">üë§ <strong id="userName"></strong></p>
                    <div class="flex gap-2 mt-2">
                        <button 
                            onclick="requestPasswordReset()" 
                            class="px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg text-sm font-semibold hover:bg-yellow-200"
                        >
                            üîë Redefinir Senha
                        </button>
                        <button 
                            onclick="logout()" 
                            class="px-4 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-semibold hover:bg-red-200"
                        >
                            üö™ Sair
                        </button>
                    </div>
                </div>
            </div>

            <!-- Main Card -->
            <div class="glass rounded-3xl shadow-2xl p-8">
                <!-- Step 1: Tema -->
                <div id="step1" class="mb-8">
                    <h2 class="text-2xl font-bold gradient-text mb-4">üéØ Passo 1: Qual √© o seu objetivo?</h2>
                    <input 
                        type="text" 
                        id="themeInput" 
                        placeholder="Ex: criar campanha de marketing no Instagram, desenvolver app em Python..."
                        class="input-field w-full px-6 py-4 rounded-xl border-2 border-gray-200 focus:outline-none text-lg"
                    />
                    <button 
                        onclick="detectCategory()" 
                        class="btn-primary w-full mt-4 px-8 py-4 rounded-xl text-white font-semibold text-lg"
                    >
                        üöÄ Gerar Template Personalizado
                    </button>
                </div>

                <!-- Category Detection -->
                <div id="categoryResult" class="hidden mb-8">
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 category-badge">
                        <h3 class="text-xl font-bold gradient-text mb-2">üìÇ Categoria Detectada:</h3>
                        <p id="detectedCategory" class="text-2xl font-bold text-gray-800"></p>
                        <p id="categoryDesc" class="text-gray-600 mt-2"></p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div id="progressSection" class="hidden mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-semibold text-gray-600">Progresso</span>
                        <span id="progressText" class="text-sm font-bold gradient-text">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                        <div id="progressBar" class="progress-bar h-full bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Lacunas Form -->
                <div id="lacunasForm" class="hidden mb-8">
                    <h3 class="text-2xl font-bold gradient-text mb-6">üìù Preencha as lacunas personalizadas:</h3>
                    <div id="lacunasContainer" class="space-y-4"></div>
                </div>

                <!-- Action Buttons -->
                <div id="actionButtons" class="hidden flex gap-4 mb-8">
                    <button 
                        onclick="generatePrompt()" 
                        class="btn-primary flex-1 px-6 py-4 rounded-xl text-white font-semibold"
                    >
                        ‚ú® Gerar Prompt Final
                    </button>
                    <button 
                        onclick="resetForm()" 
                        class="flex-1 px-6 py-4 rounded-xl border-2 border-gray-300 text-gray-700 font-semibold hover:bg-gray-50"
                    >
                        üîÑ Come√ßar Novamente
                    </button>
                </div>

                <!-- Generated Prompt -->
                <div id="promptResult" class="hidden">
                    <h3 class="text-2xl font-bold gradient-text mb-4">üéâ Seu Prompt Profissional:</h3>
                    <div class="bg-gray-50 rounded-xl p-6 border-2 border-gray-200">
                        <pre id="generatedPrompt" class="mono text-sm whitespace-pre-wrap text-gray-800"></pre>
                    </div>
                    <div class="flex gap-4 mt-4">
                        <button 
                            onclick="copyPrompt()" 
                            class="btn-primary flex-1 px-6 py-3 rounded-xl text-white font-semibold"
                        >
                            üìã Copiar Prompt
                        </button>
                        <button 
                            onclick="exportTXT()" 
                            class="flex-1 px-6 py-3 rounded-xl border-2 border-purple-500 text-purple-600 font-semibold hover:bg-purple-50"
                        >
                            üíæ Exportar TXT
                        </button>
                        <button 
                            onclick="exportJSON()" 
                            class="flex-1 px-6 py-3 rounded-xl border-2 border-indigo-500 text-indigo-600 font-semibold hover:bg-indigo-50"
                        >
                            üì¶ Exportar JSON
                        </button>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="text-center mt-8 text-white">
                <p class="text-sm opacity-75">
                    Desenvolvido com üíú por <a href="#" class="brand-link text-white hover:text-white">Cassia Prompt</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Modal Solicita√ß√£o de Redefini√ß√£o -->
    <div id="resetModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="glass rounded-2xl p-8 max-w-md w-full">
            <h3 class="text-2xl font-bold gradient-text mb-4">üîë Redefinir Senha</h3>
            <p class="text-gray-600 mb-4">
                Sua solicita√ß√£o ser√° enviada ao administrador para aprova√ß√£o.
            </p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        Motivo da solicita√ß√£o:
                    </label>
                    <textarea 
                        id="resetReason"
                        rows="3"
                        placeholder="Ex: Esqueci minha senha"
                        class="input-field w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none"
                    ></textarea>
                </div>
                <div class="flex gap-4">
                    <button 
                        onclick="sendResetRequest()" 
                        class="btn-primary flex-1 px-6 py-3 rounded-xl text-white font-semibold"
                    >
                        üì§ Enviar Solicita√ß√£o
                    </button>
                    <button 
                        onclick="closeResetModal()" 
                        class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300"
                    >
                        ‚ùå Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do Link √önico
        const ADMIN_TOKEN = 'cassia-admin-2026'; // Token secreto para criar novos clientes
        const ACCESS_TOKEN = 'access-cassia-2026'; // Token de acesso √∫nico

        // Templates - 12 categorias diversas com 5-6 lacunas interativas
        const templates = {
            criativo: {
                name: 'Cria√ß√£o Art√≠stica',
                desc: 'Para projetos criativos, arte, m√∫sica, design',
                icon: 'üé®',
                lacunas: [
                    { id: 'PROJETO', label: 'Que projeto criativo?', placeholder: 'Ex: Ilustra√ß√µes infantis, Logo minimalista, M√∫sica eletr√¥nica', tipo: 'text', obrigatorio: true },
                    { id: 'ESTILO', label: 'Qual estilo/vibe?', placeholder: 'Ex: Aquarela delicada, Brutalist moderno, Lo-fi chill', tipo: 'text', obrigatorio: true },
                    { id: 'PROPOSITO', label: 'Para que serve?', placeholder: 'Ex: Livro infantil, Identidade visual startup, Playlist Spotify', tipo: 'text', obrigatorio: true },
                    { id: 'INSPIRACAO', label: 'Refer√™ncias/Inspira√ß√µes?', placeholder: 'Ex: Studio Ghibli, Apple Design, Daft Punk', tipo: 'textarea', obrigatorio: false },
                    { id: 'PUBLICO_ALVO', label: 'Quem vai ver/usar?', placeholder: 'Ex: Crian√ßas 4-8 anos, Empreendedores tech, Jovens 18-25', tipo: 'text', obrigatorio: false }
                ]
            },
            escritor: {
                name: 'Escrita & Storytelling',
                desc: 'Para livros, roteiros, hist√≥rias, narrativas',
                icon: 'üìñ',
                lacunas: [
                    { id: 'TIPO', label: 'Que tipo de hist√≥ria?', placeholder: 'Ex: Romance contempor√¢neo, Thriller psicol√≥gico, Roteiro curta', tipo: 'text', obrigatorio: true },
                    { id: 'TEMA', label: 'Tema principal?', placeholder: 'Ex: Amor improv√°vel, Segredos de fam√≠lia, Identidade', tipo: 'text', obrigatorio: true },
                    { id: 'PERSONAGENS', label: 'Personagens principais?', placeholder: 'Ex: Ana (25, jornalista c√≠nica) e Pedro (30, chef sonhador)', tipo: 'textarea', obrigatorio: true },
                    { id: 'CONFLITO', label: 'Qual o conflito/plot?', placeholder: 'Ex: Ana descobre que Pedro esconde um passado sombrio', tipo: 'textarea', obrigatorio: true },
                    { id: 'TOM', label: 'Tom da narrativa?', placeholder: 'Ex: Leve e divertido, Tenso e investigativo, Po√©tico', tipo: 'text', obrigatorio: false }
                ]
            },
            saude: {
                name: 'Sa√∫de & Bem-estar',
                desc: 'Para treinos, nutri√ß√£o, medita√ß√£o, terapia',
                icon: 'üßò',
                lacunas: [
                    { id: 'AREA', label: '√Årea da sa√∫de?', placeholder: 'Ex: Treino funcional, Nutri√ß√£o vegana, Medita√ß√£o guiada', tipo: 'text', obrigatorio: true },
                    { id: 'OBJETIVO_SAUDE', label: 'Objetivo principal?', placeholder: 'Ex: Perder 10kg, Ganhar massa, Reduzir ansiedade', tipo: 'text', obrigatorio: true },
                    { id: 'PUBLICO_SAUDE', label: 'Para quem?', placeholder: 'Ex: Sedent√°rios iniciantes, Vegetarianos, Profissionais estressados', tipo: 'text', obrigatorio: true },
                    { id: 'RESTRICOES', label: 'Limita√ß√µes/Restri√ß√µes?', placeholder: 'Ex: Sem gl√∫ten, Sem equipamentos, S√≥ 15min/dia', tipo: 'textarea', obrigatorio: false },
                    { id: 'DURACAO_PLANO', label: 'Dura√ß√£o do plano?', placeholder: 'Ex: 30 dias, 12 semanas, 6 meses', tipo: 'text', obrigatorio: false }
                ]
            },
            pessoal: {
                name: 'Desenvolvimento Pessoal',
                desc: 'Para autoconhecimento, produtividade, h√°bitos',
                icon: 'üå±',
                lacunas: [
                    { id: 'AREA_CRESCIMENTO', label: 'O que quer desenvolver?', placeholder: 'Ex: Produtividade, Autoconfian√ßa, Disciplina', tipo: 'text', obrigatorio: true },
                    { id: 'SITUACAO_ATUAL', label: 'Como est√° hoje?', placeholder: 'Ex: Procrastino muito, Tenho medo de falar em p√∫blico', tipo: 'textarea', obrigatorio: true },
                    { id: 'META_PESSOAL', label: 'Onde quer chegar?', placeholder: 'Ex: Finalizar projetos no prazo, Fazer palestras', tipo: 'text', obrigatorio: true },
                    { id: 'TEMPO_DISPONIVEL', label: 'Quanto tempo tem/dia?', placeholder: 'Ex: 30 minutos, 1 hora, Finais de semana', tipo: 'text', obrigatorio: false },
                    { id: 'METODO_PREFERIDO', label: 'Como prefere aprender?', placeholder: 'Ex: Lendo, Praticando, V√≠deos', tipo: 'text', obrigatorio: false }
                ]
            },
            programacao: {
                name: 'Tecnologia & C√≥digo',
                desc: 'Para apps, sites, automa√ß√µes, scripts',
                icon: 'üíª',
                lacunas: [
                    { id: 'PROJETO_TECH', label: 'O que quer criar?', placeholder: 'Ex: App de finan√ßas pessoais, Bot do Discord, Site portfolio', tipo: 'text', obrigatorio: true },
                    { id: 'TECNOLOGIA', label: 'Tecnologias/Stack?', placeholder: 'Ex: React + Node, Python + Flask, WordPress', tipo: 'text', obrigatorio: true },
                    { id: 'FUNCIONALIDADES', label: 'Principais recursos?', placeholder: 'Ex: Login Google, Gr√°ficos gastos, Notifica√ß√µes push', tipo: 'textarea', obrigatorio: true },
                    { id: 'NIVEL_TECNICO', label: 'Seu n√≠vel t√©cnico?', placeholder: 'Ex: Iniciante total, J√° sei JS b√°sico, Desenvolvedor pleno', tipo: 'text', obrigatorio: false },
                    { id: 'PRAZO_TECH', label: 'Prazo esperado?', placeholder: 'Ex: 2 semanas, 3 meses, Sem pressa', tipo: 'text', obrigatorio: false }
                ]
            },
            conteudo: {
                name: 'Conte√∫do & Redes Sociais',
                desc: 'Para posts, v√≠deos, newsletters, blogs',
                icon: 'üì±',
                lacunas: [
                    { id: 'PLATAFORMA', label: 'Qual plataforma?', placeholder: 'Ex: Instagram, YouTube, LinkedIn, Newsletter', tipo: 'text', obrigatorio: true },
                    { id: 'NICHO', label: 'Qual seu nicho/tema?', placeholder: 'Ex: Empreendedorismo digital, Viagens baratas, Tech', tipo: 'text', obrigatorio: true },
                    { id: 'TIPO_CONTEUDO', label: 'Tipo de conte√∫do?', placeholder: 'Ex: Carrossel educativo, Vlog semanal, Thread', tipo: 'text', obrigatorio: true },
                    { id: 'FREQUENCIA', label: 'Com que frequ√™ncia?', placeholder: 'Ex: 3x por semana, Di√°rio, Quinzenal', tipo: 'text', obrigatorio: false },
                    { id: 'OBJETIVO_CONTEUDO', label: 'Objetivo do conte√∫do?', placeholder: 'Ex: Vender infoproduto, Crescer audi√™ncia, Educar', tipo: 'text', obrigatorio: false }
                ]
            },
            estudo: {
                name: 'Estudo & Pesquisa',
                desc: 'Para TCC, artigos, estudos, pesquisas',
                icon: 'üî¨',
                lacunas: [
                    { id: 'TIPO_ESTUDO', label: 'Que tipo de trabalho?', placeholder: 'Ex: TCC gradua√ß√£o, Artigo cient√≠fico, Pesquisa de mercado', tipo: 'text', obrigatorio: true },
                    { id: 'TEMA_ESTUDO', label: 'Tema da pesquisa?', placeholder: 'Ex: Impacto da IA no mercado de trabalho', tipo: 'textarea', obrigatorio: true },
                    { id: 'METODOLOGIA', label: 'Metodologia?', placeholder: 'Ex: Revis√£o bibliogr√°fica, Estudo de caso, Entrevistas', tipo: 'text', obrigatorio: true },
                    { id: 'PUBLICO_ESTUDO', label: 'Para quem/onde?', placeholder: 'Ex: Universidade X, Revista Y, Empresa Z', tipo: 'text', obrigatorio: false },
                    { id: 'PRAZO_ESTUDO', label: 'Prazo de entrega?', placeholder: 'Ex: 3 meses, Junho 2026', tipo: 'text', obrigatorio: false }
                ]
            },
            eventos: {
                name: 'Eventos & Experi√™ncias',
                desc: 'Para festas, workshops, palestras, encontros',
                icon: 'üéâ',
                lacunas: [
                    { id: 'TIPO_EVENTO', label: 'Que tipo de evento?', placeholder: 'Ex: Workshop design, Festa 30 anos, Webinar, Meetup', tipo: 'text', obrigatorio: true },
                    { id: 'PUBLICO_EVENTO', label: 'Quem vai participar?', placeholder: 'Ex: 50 designers, Amigos e fam√≠lia, 200 empreendedores', tipo: 'text', obrigatorio: true },
                    { id: 'OBJETIVO_EVENTO', label: 'Objetivo do evento?', placeholder: 'Ex: Networking, Comemorar, Ensinar Figma, Lan√ßar produto', tipo: 'textarea', obrigatorio: true },
                    { id: 'FORMATO', label: 'Formato/Local?', placeholder: 'Ex: Presencial em SP, Online via Zoom, H√≠brido', tipo: 'text', obrigatorio: true },
                    { id: 'DATA_EVENTO', label: 'Quando ser√°?', placeholder: 'Ex: Mar√ßo 2026, Todo m√™s, Daqui 60 dias', tipo: 'text', obrigatorio: false }
                ]
            },
            negocios: {
                name: 'Neg√≥cios & Vendas',
                desc: 'Para empresas, produtos, servi√ßos',
                icon: 'üíº',
                lacunas: [
                    { id: 'NEGOCIO', label: 'Qual seu neg√≥cio?', placeholder: 'Ex: Consultoria financeira, E-commerce de roupas', tipo: 'text', obrigatorio: true },
                    { id: 'PRODUTO_SERVICO', label: 'O que vende/oferece?', placeholder: 'Ex: Planejamento financeiro personalizado', tipo: 'textarea', obrigatorio: true },
                    { id: 'PUBLICO_NEG', label: 'Quem √© seu cliente?', placeholder: 'Ex: Profissionais liberais 30-45 anos', tipo: 'text', obrigatorio: true },
                    { id: 'PROBLEMA_RESOLVE', label: 'Que problema resolve?', placeholder: 'Ex: Desorganiza√ß√£o financeira, endividamento', tipo: 'text', obrigatorio: true },
                    { id: 'DIFERENCIAL_NEG', label: 'Seu diferencial?', placeholder: 'Ex: M√©todo pr√≥prio validado por 1000+ clientes', tipo: 'text', obrigatorio: false }
                ]
            },
            viagem: {
                name: 'Viagem & Turismo',
                desc: 'Para roteiros, guias, planejamento de viagens',
                icon: '‚úàÔ∏è',
                lacunas: [
                    { id: 'DESTINO', label: 'Para onde vai?', placeholder: 'Ex: Jap√£o, Europa, Nordeste brasileiro', tipo: 'text', obrigatorio: true },
                    { id: 'DURACAO_VIAGEM', label: 'Quantos dias?', placeholder: 'Ex: 7 dias, 2 semanas, 1 m√™s', tipo: 'text', obrigatorio: true },
                    { id: 'PERFIL_VIAJANTE', label: 'Seu perfil de viagem?', placeholder: 'Ex: Mochileiro econ√¥mico, Luxo e conforto, Aventura', tipo: 'text', obrigatorio: true },
                    { id: 'INTERESSES', label: 'O que quer fazer?', placeholder: 'Ex: Cultura e museus, Praias, Gastronomia, Natureza', tipo: 'textarea', obrigatorio: true },
                    { id: 'ORCAMENTO', label: 'Or√ßamento dispon√≠vel?', placeholder: 'Ex: R$ 5 mil, R$ 15 mil, Ilimitado', tipo: 'text', obrigatorio: false }
                ]
            },
            educacao: {
                name: 'Educa√ß√£o & Ensino',
                desc: 'Para aulas, cursos, materiais did√°ticos',
                icon: 'üìö',
                lacunas: [
                    { id: 'DISCIPLINA', label: 'O que vai ensinar?', placeholder: 'Ex: Matem√°tica b√°sica, Ingl√™s conversa√ß√£o, Piano', tipo: 'text', obrigatorio: true },
                    { id: 'NIVEL_ENSINO', label: 'Que n√≠vel?', placeholder: 'Ex: Infantil, Fundamental, Adulto iniciante', tipo: 'text', obrigatorio: true },
                    { id: 'FORMATO_AULA', label: 'Como vai ensinar?', placeholder: 'Ex: Aulas presenciais, V√≠deo-aulas, Apostila + exerc√≠cios', tipo: 'text', obrigatorio: true },
                    { id: 'OBJETIVO_ENSINO', label: 'O aluno vai conseguir...?', placeholder: 'Ex: Resolver equa√ß√µes, Conversar em viagens, Tocar m√∫sica b√°sica', tipo: 'textarea', obrigatorio: true },
                    { id: 'DURACAO_CURSO', label: 'Dura√ß√£o total?', placeholder: 'Ex: 3 meses, 40 horas, 1 ano letivo', tipo: 'text', obrigatorio: false }
                ]
            },
            juridico: {
                name: 'Jur√≠dico & Documentos',
                desc: 'Para contratos, termos, documentos legais',
                icon: '‚öñÔ∏è',
                lacunas: [
                    { id: 'TIPO_DOC', label: 'Que tipo de documento?', placeholder: 'Ex: Contrato de presta√ß√£o, Termo de uso, Acordo', tipo: 'text', obrigatorio: true },
                    { id: 'PARTES', label: 'Entre quem?', placeholder: 'Ex: Freelancer e cliente, Empresa e usu√°rio, S√≥cios', tipo: 'text', obrigatorio: true },
                    { id: 'OBJETIVO_DOC', label: 'Objetivo do documento?', placeholder: 'Ex: Formalizar presta√ß√£o de servi√ßos de design', tipo: 'textarea', obrigatorio: true },
                    { id: 'PONTOS_PRINCIPAIS', label: 'Cl√°usulas essenciais?', placeholder: 'Ex: Prazo entrega, Forma pagamento, Direitos autorais', tipo: 'textarea', obrigatorio: true },
                    { id: 'JURISDICAO', label: 'Legisla√ß√£o aplic√°vel?', placeholder: 'Ex: Brasil, Portugal, Internacional', tipo: 'text', obrigatorio: false }
                ]
            }
        };

        let currentTemplate = null;
        let filledLacunas = {};
        let currentUser = null;

        // Verificar acesso e autenticar automaticamente
        function checkAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const clientId = urlParams.get('client');

            // Se n√£o tiver token, redirecionar para p√°gina de erro
            if (token !== ACCESS_TOKEN && token !== ADMIN_TOKEN) {
                document.body.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="glass rounded-2xl p-8 max-w-md text-center">
                            <div class="text-6xl mb-4">üîí</div>
                            <h1 class="text-3xl font-bold gradient-text mb-4">Acesso Negado</h1>
                            <p class="text-gray-600 mb-6">Este link n√£o √© v√°lido ou expirou.</p>
                            <p class="text-sm text-gray-500">Entre em contato com o administrador.</p>
                        </div>
                    </div>
                `;
                return false;
            }

            // Buscar ou criar cliente
            if (clientId) {
                const clients = JSON.parse(localStorage.getItem('cassia_clients') || '[]');
                currentUser = clients.find(c => c.id === clientId);
                
                if (!currentUser) {
                    // Criar novo cliente
                    currentUser = {
                        id: clientId,
                        name: 'Cliente ' + clientId.substring(0, 8),
                        email: clientId + '@cliente.com',
                        createdAt: new Date().toISOString(),
                        lastAccess: new Date().toISOString(),
                        resetRequests: []
                    };
                    clients.push(currentUser);
                    localStorage.setItem('cassia_clients', JSON.stringify(clients));
                } else {
                    // Atualizar √∫ltimo acesso
                    currentUser.lastAccess = new Date().toISOString();
                    const clients = JSON.parse(localStorage.getItem('cassia_clients') || '[]');
                    const index = clients.findIndex(c => c.id === clientId);
                    clients[index] = currentUser;
                    localStorage.setItem('cassia_clients', JSON.stringify(clients));
                }

                localStorage.setItem('cassia_current_user', JSON.stringify(currentUser));
            }

            return true;
        }

        // Inicializar aplica√ß√£o
        function initApp() {
            if (!checkAccess()) return;

            // Esconder loading, mostrar app
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userName').textContent = currentUser.name;
            }, 1000);
        }

        function detectCategory() {
            const theme = document.getElementById('themeInput').value.toLowerCase();
            
            if (!theme) {
                alert('Por favor, descreva seu objetivo!');
                return;
            }

            let category = 'criativo'; // padr√£o criativo
            
            // Criativo & Arte
            if (theme.match(/arte|design|ilustra|m√∫sica|pintar|desenh|logo|brand|identidade visual|criar arte|aquarela|gr√°fico/i)) {
                category = 'criativo';
            }
            // Escrita & Literatura
            else if (theme.match(/livro|hist√≥ria|romance|roteiro|conto|poesia|escrever.*hist√≥ria|narrativa|personagem|fic√ß√£o|novela/i)) {
                category = 'escritor';
            }
            // Sa√∫de & Bem-estar
            else if (theme.match(/treino|exerc√≠cio|dieta|nutri√ß√£o|emagrec|medita|yoga|sa√∫de|fitness|muscula√ß√£o|perder peso/i)) {
                category = 'saude';
            }
            // Desenvolvimento Pessoal
            else if (theme.match(/produtividade|h√°bito|autoconhecimento|disciplina|foco|organiza|melhora|desenvolv.*pessoa|crescimento/i)) {
                category = 'pessoal';
            }
            // Programa√ß√£o & Tech
            else if (theme.match(/c√≥digo|programar|app|aplicativo|sistema|software|python|javascript|react|api|web|site|tech|desenvolv.*sistema/i)) {
                category = 'programacao';
            }
            // Conte√∫do & Social Media
            else if (theme.match(/post|instagram|tiktok|youtube|rede.*social|conte√∫do.*digital|influenc|creator|v√≠deo|reel|stories/i)) {
                category = 'conteudo';
            }
            // Estudo & Pesquisa
            else if (theme.match(/tcc|monografia|artigo.*cient√≠fico|pesquisa|estudo|acad√™mico|disserta√ß√£o|tese|trabalho.*conclus√£o/i)) {
                category = 'estudo';
            }
            // Eventos
            else if (theme.match(/evento|festa|workshop|palestra|webinar|meetup|confer√™ncia|encontro|semin√°rio|congresso/i)) {
                category = 'eventos';
            }
            // Viagem
            else if (theme.match(/viagem|roteiro|viajar|turismo|destino|mochil|trip|f√©rias|passeio|tour/i)) {
                category = 'viagem';
            }
            // Educa√ß√£o
            else if (theme.match(/aula|curso|ensino|ensinar|professor|aluno|escola|did√°tico|pedagogia|lecionar/i)) {
                category = 'educacao';
            }
            // Jur√≠dico
            else if (theme.match(/contrato|termo|jur√≠dico|legal|acordo|cl√°usula|direito|advogad|lei|documento.*legal/i)) {
                category = 'juridico';
            }
            // Neg√≥cios & Vendas
            else if (theme.match(/neg√≥cio|empresa|vendas|marketing|campanha|an√∫ncio|startup|empreend|cliente|comercial/i)) {
                category = 'negocios';
            }

            currentTemplate = templates[category];
            filledLacunas = {};

            document.getElementById('categoryResult').classList.remove('hidden');
            document.getElementById('detectedCategory').innerHTML = `
                <span class="text-4xl mr-3">${currentTemplate.icon}</span>
                ${currentTemplate.name}
            `;
            document.getElementById('categoryDesc').textContent = currentTemplate.desc;

            generateLacunasForm();

            document.getElementById('progressSection').classList.remove('hidden');
            document.getElementById('lacunasForm').classList.remove('hidden');
            document.getElementById('actionButtons').classList.remove('hidden');

            updateProgress();
        }

        function generateLacunasForm() {
            const container = document.getElementById('lacunasContainer');
            container.innerHTML = '';

            currentTemplate.lacunas.forEach((lacuna, index) => {
                const div = document.createElement('div');
                div.className = 'lacuna-card bg-white p-5 rounded-xl shadow-sm hover:shadow-md transition-all';
                
                const obrigatorioTag = lacuna.obrigatorio ? 
                    '<span class="text-red-500 ml-1">*</span>' : 
                    '<span class="text-gray-400 text-xs ml-2">(opcional)</span>';
                
                let inputHTML = '';
                if (lacuna.tipo === 'textarea') {
                    inputHTML = `
                        <textarea 
                            id="lacuna_${lacuna.id}" 
                            placeholder="${lacuna.placeholder}"
                            oninput="updateLacuna('${lacuna.id}')"
                            rows="3"
                            maxlength="500"
                            class="input-field w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none resize-none"
                        ></textarea>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-xs text-gray-400">üí° Seja espec√≠fico</span>
                            <span id="count_${lacuna.id}" class="text-xs text-gray-400">0/500</span>
                        </div>
                    `;
                } else {
                    inputHTML = `
                        <input 
                            type="text" 
                            id="lacuna_${lacuna.id}" 
                            placeholder="${lacuna.placeholder}"
                            oninput="updateLacuna('${lacuna.id}')"
                            maxlength="200"
                            class="input-field w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:outline-none"
                        />
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-xs text-gray-400">üí° Quanto mais detalhes, melhor</span>
                            <span id="count_${lacuna.id}" class="text-xs text-gray-400">0/200</span>
                        </div>
                    `;
                }
                
                div.innerHTML = `
                    <label class="flex items-center text-sm font-bold text-gray-800 mb-3">
                        <span class="flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white text-xs mr-3">
                            ${index + 1}
                        </span>
                        ${lacuna.label}${obrigatorioTag}
                    </label>
                    ${inputHTML}
                `;
                container.appendChild(div);
            });
        }

        function updateLacuna(id) {
            const element = document.getElementById(`lacuna_${id}`);
            const value = element.value;
            const maxLength = element.maxLength;
            
            // Atualizar contador
            const counter = document.getElementById(`count_${id}`);
            if (counter) {
                counter.textContent = `${value.length}/${maxLength}`;
                
                // Mudar cor conforme preenchimento
                if (value.length > maxLength * 0.8) {
                    counter.classList.remove('text-gray-400');
                    counter.classList.add('text-orange-500');
                } else if (value.length > 0) {
                    counter.classList.remove('text-gray-400', 'text-orange-500');
                    counter.classList.add('text-green-500');
                } else {
                    counter.classList.remove('text-green-500', 'text-orange-500');
                    counter.classList.add('text-gray-400');
                }
            }
            
            // Feedback visual no card
            const card = element.closest('.lacuna-card');
            
            if (value) {
                filledLacunas[id] = value;
                element.classList.remove('border-gray-200');
                element.classList.add('border-green-400', 'bg-green-50');
                card.classList.add('filled');
            } else {
                delete filledLacunas[id];
                element.classList.remove('border-green-400', 'bg-green-50');
                element.classList.add('border-gray-200');
                card.classList.remove('filled');
            }
            updateProgress();
        }

        function updateProgress() {
            const total = currentTemplate.lacunas.length;
            const filled = Object.keys(filledLacunas).length;
            const percentage = Math.round((filled / total) * 100);
            
            // Contar obrigat√≥rios
            const obrigatorios = currentTemplate.lacunas.filter(l => l.obrigatorio).length;
            const preenchidosObrigatorios = currentTemplate.lacunas.filter(l => l.obrigatorio && filledLacunas[l.id]).length;

            document.getElementById('progressBar').style.width = percentage + '%';
            
            const progressText = document.getElementById('progressText');
            progressText.textContent = `${filled}/${total} preenchidas`;
            
            // Feedback visual
            if (preenchidosObrigatorios === obrigatorios) {
                progressText.classList.remove('text-yellow-600', 'text-red-600');
                progressText.classList.add('text-green-600');
                progressText.textContent = `‚úÖ ${filled}/${total} - Pronto para gerar!`;
            } else if (filled > 0) {
                progressText.classList.remove('text-green-600', 'text-red-600');
                progressText.classList.add('text-yellow-600');
                progressText.textContent = `‚ö° ${filled}/${total} - Faltam ${obrigatorios - preenchidosObrigatorios} obrigat√≥rias`;
            } else {
                progressText.classList.remove('text-green-600', 'text-yellow-600');
                progressText.classList.add('text-red-600');
            }
        }

        function generatePrompt() {
            // Verificar campos obrigat√≥rios
            const obrigatorios = currentTemplate.lacunas.filter(l => l.obrigatorio);
            const preenchidosObrigatorios = obrigatorios.filter(l => filledLacunas[l.id]);
            
            if (preenchidosObrigatorios.length < obrigatorios.length) {
                const faltando = obrigatorios.filter(l => !filledLacunas[l.id]);
                alert(`‚ö†Ô∏è Preencha os campos obrigat√≥rios:\n\n${faltando.map(f => '‚Ä¢ ' + f.label).join('\n')}`);
                
                // Focar no primeiro campo faltando
                document.getElementById(`lacuna_${faltando[0].id}`).focus();
                return;
            }

            let prompt = `# üéØ PROMPT PROFISSIONAL - ${currentTemplate.name}\n\n`;
            prompt += `## üìã Briefing do Projeto\n\n`;

            currentTemplate.lacunas.forEach(lacuna => {
                const value = filledLacunas[lacuna.id];
                if (value) {
                    prompt += `**${lacuna.label}**\n${value}\n\n`;
                }
            });

            prompt += `## üìù Instru√ß√µes para Execu√ß√£o\n\n`;
            prompt += `Com base nas informa√ß√µes acima:\n\n`;
            prompt += `1. üéØ Analise cada detalhe fornecido com aten√ß√£o\n`;
            prompt += `2. üí° Desenvolva uma solu√ß√£o criativa e completa\n`;
            prompt += `3. ‚úÖ Garanta consist√™ncia com os objetivos\n`;
            prompt += `4. üìä Inclua exemplos pr√°ticos quando aplic√°vel\n`;
            prompt += `5. üé® Estruture de forma clara e profissional\n\n`;
            prompt += `---\n*‚ú® Prompt gerado via Cassia Prompt - ${new Date().toLocaleDateString('pt-BR')}*`;

            document.getElementById('generatedPrompt').textContent = prompt;
            document.getElementById('promptResult').classList.remove('hidden');
            document.getElementById('promptResult').scrollIntoView({ behavior: 'smooth' });
        }

        function copyPrompt() {
            const text = document.getElementById('generatedPrompt').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Prompt copiado!');
            });
        }

        function exportTXT() {
            const text = document.getElementById('generatedPrompt').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-${Date.now()}.txt`;
            a.click();
        }

        function exportJSON() {
            const data = {
                categoria: currentTemplate.name,
                objetivo: document.getElementById('themeInput').value,
                lacunas: filledLacunas,
                prompt: document.getElementById('generatedPrompt').textContent,
                gerado_em: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-${Date.now()}.json`;
            a.click();
        }

        function resetForm() {
            document.getElementById('themeInput').value = '';
            document.getElementById('categoryResult').classList.add('hidden');
            document.getElementById('progressSection').classList.add('hidden');
            document.getElementById('lacunasForm').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('promptResult').classList.add('hidden');
            currentTemplate = null;
            filledLacunas = {};
        }

        function requestPasswordReset() {
            document.getElementById('resetModal').classList.remove('hidden');
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.add('hidden');
            document.getElementById('resetReason').value = '';
        }

        function sendResetRequest() {
            const reason = document.getElementById('resetReason').value;
            
            if (!reason) {
                alert('Por favor, informe o motivo da solicita√ß√£o');
                return;
            }

            const request = {
                id: Date.now().toString(),
                clientId: currentUser.id,
                clientName: currentUser.name,
                reason: reason,
                requestedAt: new Date().toISOString(),
                status: 'pending'
            };

            // Adicionar √† lista de solicita√ß√µes do usu√°rio
            currentUser.resetRequests = currentUser.resetRequests || [];
            currentUser.resetRequests.push(request);

            // Atualizar no localStorage
            const clients = JSON.parse(localStorage.getItem('cassia_clients') || '[]');
            const index = clients.findIndex(c => c.id === currentUser.id);
            clients[index] = currentUser;
            localStorage.setItem('cassia_clients', JSON.stringify(clients));

            // Adicionar √† fila global de solicita√ß√µes
            const allRequests = JSON.parse(localStorage.getItem('cassia_reset_requests') || '[]');
            allRequests.push(request);
            localStorage.setItem('cassia_reset_requests', JSON.stringify(allRequests));

            closeResetModal();
            alert('‚úÖ Solicita√ß√£o enviada!\n\nO administrador receber√° sua solicita√ß√£o e entrar√° em contato em breve.');
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                window.location.href = 'about:blank';
            }
        }

        // Iniciar
        initApp();
    </script>
</body>
</html>